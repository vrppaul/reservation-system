# Возможности API

- Резервация конкретного стола на конкретное время
- Резервация стола в зависимости от количества человек на конкретное время
- Резервация через приложение
- Резервация через сторонние API
- Резервация игры на конкретный стол/аккаунт
- Просмотр свободных столов на дату


# Детали процесса

- Можно зарезервировать стол минимально на 60 минут.
- Существует два типа резервации: **немедленная** и **проверенная администратором**.
  ### Немедленная
  - Пользователь выбрал свободный стол на определенное время, на определенное количество человек.
  - Пользователь выбрал определенное время, на определенное количество человек, на определенную продолжительность.
  ### Проверенная администратором
  - Пользователь выбрал свободный стол на определенное время, на определенное количество человек, большее, чем предусматривает стол (стол на 4, 6 человек было выбрано).
  - Пользователь выбирает стол на определенное время, на определенную продолжительность, но эта продолжительность на полчаса меньше, чем разрыв между резервациями стола.
  - Пользователь выбирает резервацию стола больше чем на 3 часа.
  


# Реализация ендпоинтов

> Префикс всех ендпоинтов: `/api/v1`

## Клиентская зона `/client_zone`

- ### `POST /api/v1/client_zone/tables/reserve` 
  Резервация стола. Для резервации необходимо указать день и время в виде timestamp, количество часов (дефолт 2) и количество человек. 
  Проведение резервации возможно двумя способами:
  1) Пользователь знает, за каким столом он хочет сидеть. Для этого необходимо дополнительно указать id стола.
  2) Пользователю все равно, за каким столом сидеть. В этом случае указание стола ненужно.
  #### Тело запроса
  ```
  {
    "datetime": 123456789,  # datetime в секундах
    "duration": 120,        # продолжительность резервации в минутах
    "persons": 4,           # количество человек за столом
    "table_id": 1           # OPTIONAL. id стола
  }
  ```
  #### Возвращает 
  
  - Моментальный ответ.
  ```
  Успешная резервация:
  {
    "response_type": "immediate"
    "reservation_no": 123456,
    "reserved": True
  }
  
  Неуспешная резервация:
  {
    "response_type": "immediate",
    "reservation_no": 123456,
    "reserved": False,
    "reason": "table_is_booked"
  }
  ```
  - В некоторых случаях (большее количество человек, большая длительность) запрос помещается в очередь для проверки администратором.
  ```
  {
    "response_type": "queued",
    "reservation_no": 123456
  }
  ```
- ### `GET /api/v1/client_zone/tables/availability`
  Получение столов доступных на определенный день, определенное время, на определенную продолжительность и определенное количество человек.
  
  - Если передан только день и количество человек, то предлагаются все часы, доступные от минимального времени
    с длительностью минимум час.
  - Если переданы день, количество человек и время, то предлагаются все возможные интервалы на данное время.
  - Если переданы день, количество человек и длительность, то предлагаются все возможные часы на данную длительность.
  - Если переданы все параметры, то просто предлагаются столы на данные время.
    Если нет свободных столов на заданные параметры, то предлагается ближайшее время с максимально подходящей длительностью.
  
  #### Тело запроса
  ```
  {
    "date": "2021-02-09",   # дата дня в формате ISO 8601 стринга (YYYY-MM-DD)
    "persons": 4,           # количество человек за столом
    "time": "15:15",        # OPTIONAL. время резервации в формате ISO 8601 стринга (hh:mm)
    "duration": 120         # OPTIONAL. продолжительность резервации в минутах
  }
  ```
  
  #### Возвращает
  Если на данные параметры есть свободное время и свободные столы, вернется аргумент `available`
  Если на данные параметры нет ни свободного времени, ни столов, вернется аргумент `suggested`
  ```
  Запрос:
  {
    "date": "2021-02-09",
    "persons": 4
  }
  
  Ответ (имеются свободные слоты):
  {
    "available": [
      {
        "time": "17:00",
        "duration": 180,
        "table_ids": [1, 2]
      },
      {
        "time": "17:00",
        "duration": 120,
        "table_ids": [3, 4]
      },
      {
        "time": "17:00",
        "duration": 90,
        "table_ids": [5, 6]
      },
      {
        "time": "17:30",
        "duration": 150,
        "table_ids": [1, 2]
      },
      ...
    ],
    "suggested": []
  }
  ```

  ```
  Запрос:
  {
    "date": "2021-02-09",
    "persons": 4,
    "duration": 120
  }
  
  Ответ (имеются свободные слоты):
  {
    "available": [  
      # точная фильтрация
      {
        "time": "17:00",
        "duration": 120,
        "table_ids": [3, 4]
      },
      {
        "time": "19:00",
        "duration": 120,
        "table_ids": [1, 2]
      }, 
      # может быть и больше времени, требует подтверждение администратора
      {
        "time": "17:30",
        "duration": 150,
        "table_ids": [1, 2]
      },
      ...
    ],
    "suggested": []
  }
  
  Ответ (свободных слотов нет):
  {
    "available:" [],
    "suggested": [  # возможные варианты (меньше времени, не требует подтверждение администратора)
      {
        "time": "17:00",
        "duration": 90,
        "table_ids": [5, 6]
      },
      ...
    ]
  }
  
  ```
  ```
  Запрос:
  {
    "date": "2021-02-09",
    "persons": 4,
    "time": "19:00"
  }
  
  Ответ (есть свободные слоты):
  {
    "available": [  # точная фильтрация, минимум 60 минут
      {
        "time": "19:00",
        "duration": 120,
        "table_ids": [1, 2]
      },
      {
        "time": "19:00",
        "duration": 90,
        "table_ids": [3, 4]
      },
      {
        "time": "19:00",
        "duration": 60,
        "table_ids": [3, 4]
      },
      ...
    ],
    "suggested": []
  }
  
  Ответ (нет свободных слотов минимально на 60 минут):
  {
    "available": [],
    "suggested": [
      {
        "time": "19:30",
        "duration": 120,
        "table_ids": [1, 2]
      },
      {
        "time": "18:30",
        "duration": 60,
        "table_ids": [3, 4]
      },
      {
        "time": "20:00",
        "duration": 60,
        "table_ids": [3, 4]
      },
      ...   # отображение всех свободных часов до конца дня
    ]
  }
  ```
  ```
  Запрос:
  {
    "date": "2021-02-09",
    "persons": 4,
    "time": "19:00",
    "duration": 120
  }
  
  Ответ (есть свободные слоты):
  {
    "available": [  # точная фильтрация, минимум 60 минут
      {
        "time": "19:00",
        "duration": 120,
        "table_ids": [1, 2]
      }
    ],
    "suggested": []
  }
  
  Ответ (нет свободных слотов):
  {
    "available": [],
    "suggested": [
      {
        "time": "18:30",
        "duration": 120,
        "table_ids": [1, 2]
      }, 
      {
        "time": "19:30",
        "duration": 120,
        "table_ids": [1, 2]
      }, 
    ]
  }
  ```

- ### `GET /api/v1/client_zone/tables/table_available`
  Получение информации о доступности стола на определенное время.
  #### Тело запроса
  ```
  {
    "date": "2021-02-09",
    "persons": 4,
    "time": "19:00",
    "duration": 120,
    "table_id": 1
  }
  ```
  #### Возвращает
  - True, если стол свободен
  - False, если занят
  

## Администраторская зона `/api/v1/admin_zone`


# Необходимые части

- Сервер (uvicorn)
- Приложение (FastAPI)
- ORM ([orm от encode](https://github.com/encode/orm))


# Таблицы БД

- Стол
- Игра
- Пользователь
- Резервации
